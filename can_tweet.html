<html>
<head>
  <title></title>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

  <style type="text/css">
    article {
      /*position: relative;*/
      width: 500px;
      margin-top: 100px;
      margin-left:200px;
    }

    #num_of_chars {
      display: none;

      position: absolute;
      border: 2px black solid;
      padding: 2px;
      border-radius: 1px;
      background-color: white;
      z-index: 100;
    }

    #tweet_button {
      display: none;

      position: absolute;
      border: 2px black solid;
      background-image:url('http://cornishrebels.co.uk/wp-content/uploads/2013/11/Twitter-bird-logo-PNG.png');
      background-size: 25px auto;
      background-repeat:no-repeat;
      background-position: center center;

      height: 25px;
      width: 25px;
      border-radius: 50%;
      background-color: white;
      z-index: 100;
      cursor: pointer;
    }

  </style>
  <script type="text/javascript">
    $(document).ready(function () {
        function getSelectionText(){
          return window.getSelection().toString();
        }

        function getSelectionTextAndShowNumOfChars() {
            var text = "";
            if (window.getSelection) {
                text = window.getSelection().toString();
                if (text.length > 1 && text.length <= 90) {
                    $('#num_of_chars').html("<span style='color:green'>" + text.length + " </span>");
                }
                else if (text.length > 90) {
                    var tooMany = text.length - 90;
                    $('#num_of_chars').html("<span style='color:red'>-" + tooMany + " </span>");
                }
                else {
                    // $('#num_of_chars').hide().html("Not yet") //.css("display", "none");
                }   
            }
            return text;
        }

        // var isDragging = false;

        // var relX = 0;
        // var relY = 0;

        // $('article').mousedown(function(){
        //   if (window.getSelection().toString().length >= 1) {
        //     $('#num_of_chars').show();
        //   }
        //   $('article').mousemove(function(e){
        //     getSelectionTextAndShowNumOfChars();
        //     $('#num_of_chars').css("top", e.pageY + 10).css("left", e.pageX + 10);
        //   });
        // });


        $('article').on("mouseup", function(e){
          $('#num_of_chars').hide();
          if (window.getSelection().toString().length >= 1) {
            text = getSelectionText();   
            $('#tweet_button').show().css("top", e.pageY - 50).css("left", 425); // e.pageX + 10
            $('#tweet_button').click(function(){
              window.open("http://twitter.com/home?status=" + text + " " + document.URL, "Tweet", "width=400,height=250");
            });
            if (text.length > 90) {
              $('#tweet_button').css('opacity', '0.6');
            } else {
              $('#tweet_button').css('opacity', '1');
            }
            // $('#tweet_button').html("<a href='http://twitter.com/home?status=" + text + "' target='_blank'></a>");
            // <img src='http://cornishrebels.co.uk/wp-content/uploads/2013/11/Twitter-bird-logo-PNG.png' width='20px' />
          } else {
           $('#tweet_button').hide();
          }
        });

        $(document).on("mousedown", function(e){
          if ($(e.target).attr("class") != "article_paragraph" && $(e.target).attr("id") != "tweet_button") {
            $('#tweet_button').hide();
          }
        });


    });
  </script>
</head>
<body>
  <article>
    <p class="article_paragraph">
      Lorem ipsum dolor sit amet, consectetur adipisicing elit. Itaque error fuga nihil quos aut repellat maxime ea consequuntur veritatis aspernatur illo deserunt tempore quasi necessitatibus consequatur mollitia quidem voluptates aperiam.
      Lorem ipsum dolor sit amet, consectetur adipisicing elit. Itaque error fuga nihil quos aut repellat maxime ea consequuntur veritatis aspernatur illo deserunt tempore quasi necessitatibus consequatur mollitia quidem voluptates aperiam.
      Lorem ipsum dolor sit amet, consectetur adipisicing elit. Itaque error fuga nihil quos aut repellat maxime ea consequuntur veritatis aspernatur illo deserunt tempore quasi necessitatibus consequatur mollitia quidem voluptates aperiam.

    </p>
  
    <p id="num_of_chars">Not yet</p>
  </article>
    <div id="tweet_button">
      <!-- <a href="http://www.twitter.com" target="_blank">Tweet</a> -->
    </div>
  
</body>
</html>